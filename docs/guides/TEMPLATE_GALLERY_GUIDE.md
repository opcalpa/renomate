# ğŸ“‹ Template Gallery - Spara & Ã…teranvÃ¤nd Canvas-Delar

## ğŸ‰ Vad Ã„r Template Gallery?

Ett **snippet-library fÃ¶r arkitektur**! Spara grupper av objekt (vÃ¤ggar, badkar, dÃ¶rrar, etc.) som Ã¥teranvÃ¤ndbara mallar.

### **Exempel pÃ¥ Mallar:**
- **"Badrum Komplett"** - Toalett + Handfat + Badkar + Kakel-vÃ¤ggar
- **"L-formad VÃ¤gg"** - TvÃ¥ vÃ¤ggar i 90Â° vinkel
- **"Eluttag Trio"** - Tre eluttag i rad
- **"Standard DÃ¶rr"** - DÃ¶rr med karm och swing-arc
- **"KÃ¶k U-form"** - BÃ¤nkar, spis, kyl, diskho i U-formation

---

## âœ¨ Nyckelfunktioner

### **1. Spara Som Mall**
```
Markera objekt â†’ Klicka "ğŸ’¾ Spara som Mall" â†’ Ge namn â†’ Spara
â†’ Mallen sparas i Template Gallery!
```

### **2. Placera Mall**
```
Ã–ppna Template Gallery â†’ VÃ¤lj mall â†’ Klicka pÃ¥ canvas
â†’ Alla objekt placeras som vanliga editerbara shapes!
```

### **3. Alla Objekt Blir Editerbara**
NÃ¤r du placerar en mall skapas **vanliga shapes** (inte en "grupp").
- âœ… Varje shape kan flyttas individuellt
- âœ… Kan Ã¤ndras i storlek
- âœ… Kan roteras
- âœ… Kan editeras precis som manuellt skapade objekt

---

## ğŸš€ Snabbstart

### **Steg 1: Spara Din FÃ¶rsta Mall**

**Exempel: Spara ett Badkar som Mall**

```
1. Rita eller placera ett badkar pÃ¥ canvas
2. Markera badkaret (klicka pÃ¥ det)
3. I vÃ¤nster toolbar, se "ğŸ’¾"-knappen (Bookmark-ikon, blÃ¥)
   â†’ Denna syns ENDAST nÃ¤r nÃ¥got Ã¤r markerat!
4. Klicka "ğŸ’¾ Spara som Mall"
5. Fyll i:
   - Namn: "Standard Badkar"
   - Emoji: ğŸ›
   - Kategori: Badrum
   - Beskrivning: "Standardstorlek badkar 1700Ã—700mm"
6. Klicka "ğŸ’¾ Spara Mall"
â†’ âœ… Mallen Ã¤r sparad!
```

### **Steg 2: Placera Mallen**

```
1. I vÃ¤nster toolbar, klicka ğŸ“‹ (Copy-ikon)
   â†’ Template Gallery Ã¶ppnas
2. Hitta "Standard Badkar" i listan
3. Klicka pÃ¥ mallen fÃ¶r att vÃ¤lja
4. Klicka "Placera Mall"-knappen (eller stÃ¤ng galleriet)
5. Klicka pÃ¥ canvas dÃ¤r du vill placera
â†’ âœ… Badkaret placeras!
6. Nu kan du dra, rotera, eller Ã¤ndra storlek pÃ¥ badkaret
```

---

## ğŸ¨ ArbetsflÃ¶de: Spara Komplexa Mallar

### **Exempel: Badrum Komplett**

**Vad vi vill spara:**
- 1 Toalett
- 1 Handfat
- 1 Badkar
- 4 VÃ¤ggar (badrumsyta)
- 2 Eluttag
- 1 Lampknapp

**Steg:**

```
1. Rita/Placera alla dessa objekt pÃ¥ canvas
2. Arrangera dem i Ã¶nskad layout
3. Markera ALLA objekt:
   - Dra en markÃ¶r Ã¶ver alla
   - ELLER: Klicka fÃ¶rsta â†’ Shift+klicka sista
   - ELLER: Cmd+A (markera allt)
4. Klicka "ğŸ’¾ Spara som Mall" (bookmark-knappen)
5. Fyll i:
   - Namn: "Badrum Komplett"
   - Emoji: ğŸš¿
   - Kategori: Badrum
   - Beskrivning: "Komplett badrum 2Ã—2m med alla fixtures"
   - Taggar: standard, modern, kompakt
6. Spara
â†’ âœ… Mall med 9 objekt sparad!
```

**Nu nÃ¤r du placerar mallen:**
- Alla 9 objekt placeras pÃ¥ canvas
- De behÃ¥ller sina **relativa positioner** till varandra
- Men varje objekt Ã¤r **individuellt editerbart**

---

## ğŸ“ Var Hittar Du Funktionerna?

### **"ğŸ’¾ Spara som Mall" (Bookmark-knappen)**

```
Space Planner
  â†’ VÃ¤nster toolbar
    â†’ Objekt-sektion (nedanfÃ¶r Settings-ikonen âš™ï¸)
    â†’ Bookmark-ikon (ğŸ’¾, blÃ¥ bakgrund)
      â†’ Syns ENDAST nÃ¤r objekt Ã¤r markerade!
```

**Visuellt:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   [ğŸ“š]        â”‚ â† Library (SymbolSelector)
â”‚   [âš™ï¸]        â”‚ â† Settings (Object Library Manager)
â”‚   [ğŸ“‹]        â”‚ â† Copy (Template Gallery) **NY!**
â”‚   [ğŸ’¾]        â”‚ â† Bookmark (Spara som Mall) **NY!** (Syns nÃ¤r selected)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **"ğŸ“‹ Template Gallery" (Copy-knappen)**

```
Space Planner
  â†’ VÃ¤nster toolbar
    â†’ Objekt-sektion
    â†’ Copy-ikon (ğŸ“‹)
      â†’ Template Gallery Ã¶ppnas
```

---

## ğŸ—‚ï¸ Template Gallery - GrÃ¤nssnitt

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“‹ Mall-Galleri                                      [âœ•]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  VÃ„NSTER (Lista)         â”‚  HÃ–GER (Detaljer)               â”‚
â”‚                          â”‚                                 â”‚
â”‚  [ğŸ” SÃ¶k mallar...]      â”‚  ğŸ›                              â”‚
â”‚  [Alla kategorier â–¼]     â”‚  Standard Badkar                â”‚
â”‚  [Exportera] [Importera] â”‚  Standardstorlek 1700Ã—700mm     â”‚
â”‚                          â”‚                                 â”‚
â”‚  ğŸ› Standard Badkar      â”‚  Kategori: Badrum               â”‚
â”‚     bathroom â€¢ 1 objekt  â”‚  Antal objekt: 1                â”‚
â”‚     1700Ã—700mm           â”‚  Storlek: 1700Ã—700mm            â”‚
â”‚                          â”‚  Taggar: [standard]             â”‚
â”‚  ğŸš¿ Badrum Komplett      â”‚                                 â”‚
â”‚     bathroom â€¢ 9 objekt  â”‚  [Placera Mall]                 â”‚
â”‚     2000Ã—2000mm          â”‚                                 â”‚
â”‚                          â”‚                                 â”‚
â”‚  ğŸ”Œ Eluttag Trio         â”‚                                 â”‚
â”‚     electrical â€¢ 3 obj   â”‚                                 â”‚
â”‚     300Ã—100mm            â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Funktioner i Galleriet:**

#### **SÃ¶k**
SÃ¶k pÃ¥:
- Mallnamn
- Beskrivning
- Taggar

#### **Filtrera efter Kategori**
- VÃ¤ggar
- Badrum
- KÃ¶k
- El
- MÃ¶bler
- DÃ¶rrar & FÃ¶nster
- Trappor
- Struktur
- Ã–vrigt

#### **Exportera/Importera**
- **Exportera:** Spara alla mallar som JSON-fil (backup)
- **Importera:** Ladda mallar frÃ¥n JSON (dela med team)

#### **Radera**
- Klicka ğŸ—‘ï¸ pÃ¥ en mall fÃ¶r att radera den

---

## ğŸ¯ Praktiska AnvÃ¤ndningsfall

### **Use Case 1: Spara VÃ¤ggstrukturer**

**Problem:** Du ritar ofta L-formade vÃ¤ggar.

**LÃ¶sning:**
```
1. Rita tvÃ¥ vÃ¤ggar i 90Â° vinkel (t.ex. 3m + 2m)
2. Markera bÃ¥da vÃ¤ggarna
3. Spara som mall: "L-vÃ¤gg Standard"
4. Kategori: VÃ¤ggar
â†’ Nu kan du placera L-vÃ¤ggar med ett klick!
```

### **Use Case 2: Standard El-Konfiguration**

**Problem:** Varje rum behÃ¶ver 3 eluttag i rad.

**LÃ¶sning:**
```
1. Placera 3 eluttag med 50cm mellanrum
2. Markera alla 3
3. Spara som mall: "Eluttag Trio"
4. Kategori: El
â†’ Placera trios var som helst!
```

### **Use Case 3: Hela Rum-Mallar**

**Problem:** Du bygger 10 identiska lÃ¤genheter.

**LÃ¶sning:**
```
1. Rita fÃ¶rsta lÃ¤genheten komplett:
   - VÃ¤ggar
   - KÃ¶k (spis, kyl, diskho, bÃ¤nkar)
   - Badrum (toalett, handfat, dusch)
   - El-uttag
   - Lampknappar
2. Markera ALLT (Cmd+A)
3. Spara som mall: "LÃ¤genhet 2 ROK"
4. Kategori: Struktur
â†’ Placera 9 kopior med nÃ¥gra klick!
```

### **Use Case 4: Arkitektoniska Detaljer**

**Problem:** StandarddÃ¶rr med karm och swing-arc Ã¤r jobbig att rita varje gÃ¥ng.

**LÃ¶sning:**
```
1. Rita dÃ¶rr med karm (2 vertikala linjer)
2. Rita swing-arc (90Â° bÃ¥ge)
3. Markera alla 3 delar
4. Spara som mall: "DÃ¶rr Standard 90cm"
5. Kategori: DÃ¶rrar & FÃ¶nster
â†’ Perfekta dÃ¶rrar varje gÃ¥ng!
```

---

## ğŸ“Š Mallens InnehÃ¥ll

### **Vad Sparas i en Mall?**

**âœ… Sparas:**
- **Alla objekt** (vÃ¤ggar, rum, library-objekt, etc.)
- **Relativa positioner** (hur objekten fÃ¶rhÃ¥ller sig till varandra)
- **Storlekar** (dimensioner bevaras)
- **FÃ¤rger** (stroke, fill)
- **Metadata** (namn, kategorier, etc.)

**âŒ Sparas INTE:**
- Absoluta koordinater (mallen blir placerbar var som helst)
- Plan-ID (ny plan-ID assignas vid placering)
- Shape-IDs (nya unika IDs genereras)

### **Exempel: Badrum-Mall JSON**

```json
{
  "id": "template-abc123",
  "name": "Badrum Komplett",
  "category": "bathroom",
  "icon": "ğŸš¿",
  "shapes": [
    {
      "type": "wall",
      "coordinates": { "points": [
        { "x": 0, "y": 0 },
        { "x": 2000, "y": 0 }
      ]},
      "strokeWidth": 200,
      ...
    },
    {
      "type": "freehand",
      "metadata": {
        "isObjectLibrary": true,
        "objectId": "toilet_standard",
        "placementX": 500,
        "placementY": 500
      },
      ...
    },
    ...
  ],
  "bounds": {
    "width": 2000,
    "height": 2000,
    ...
  }
}
```

---

## ğŸ”„ Vad HÃ¤nder NÃ¤r Du Placerar?

### **Steg-fÃ¶r-Steg:**

```
1. Du klickar pÃ¥ canvas vid position (X, Y)
2. Systemet hÃ¤mtar mallen frÃ¥n localStorage
3. FÃ¶r varje shape i mallen:
   a. Skapa ny unik ID (crypto.randomUUID())
   b. Konvertera relativa koordinater till absoluta:
      - shape.x (relativ) + X (klick) = shape.x (absolut)
      - shape.y (relativ) + Y (klick) = shape.y (absolut)
   c. Assigna aktuell plan-ID
   d. LÃ¤gg till shape till canvas (addShape())
4. Toast-meddelande: "âœ¨ Mall 'Badrum' placerad (9 objekt)"
â†’ âœ… Alla shapes Ã¤r nu vanliga editerbara objekt!
```

### **Viktigt:**

Mallens objekt Ã¤r **INTE en grupp**! 
- De placeras som individuella shapes
- Varje shape kan flyttas/editeras separat
- De "ihÃ¥ller inte ihop" efter placering
- Om du vill flytta allt tillsammans: Markera alla (Cmd+A) â†’ Dra

---

## ğŸ’¾ Lagring & Backup

### **Var Sparas Mallar?**

**localStorage**
- Nyckel: `floormap_template_library`
- Format: JSON-array
- Kapacitet: ~5-10MB (1000+ mallar)
- Persistent: Sparas mellan sessioner

### **Backup (Exportera)**

```
1. Ã–ppna Template Gallery
2. Klicka "Exportera"
3. JSON-fil laddas ned: templates-2026-01-21.json
4. Spara filen sÃ¤kert
â†’ âœ… Backup klar!
```

### **Dela med Team (Importera)**

```
1. Ta emot JSON-fil frÃ¥n kollega
2. Ã–ppna Template Gallery
3. Klicka "Importera"
4. VÃ¤lj JSON-filen
â†’ âœ… Alla mallar frÃ¥n filen importeras!
```

---

## âš™ï¸ Tekniska Detaljer

### **Filer Skapade:**

1. âœ… `templateDefinitions.ts` - Template types, logic, storage
2. âœ… `SaveTemplateDialog.tsx` - UI fÃ¶r att spara mallar
3. âœ… `TemplateGallery.tsx` - UI fÃ¶r att blÃ¤ddra/vÃ¤lja mallar
4. âœ… `store.ts` - `pendingTemplateId` state & action
5. âœ… `SimpleToolbar.tsx` - Template-knappar
6. âœ… `UnifiedKonvaCanvas.tsx` - Template placement logic

### **State Management:**

```typescript
// Store
pendingTemplateId: string | null

// Action
setPendingTemplateId: (templateId: string | null) => void
```

### **Key Functions:**

```typescript
// Normalisera shapes till relativa koordinater
normalizeShapes(shapes: FloorMapShape[]): FloorMapShape[]

// BerÃ¤kna bounding box
calculateBounds(shapes: FloorMapShape[]): Bounds

// Placera template pÃ¥ canvas
placeTemplateShapes(
  template: Template, 
  position: {x, y}, 
  planId: string
): FloorMapShape[]

// Lagring
getCustomTemplates(): Template[]
saveCustomTemplates(templates: Template[]): void
addTemplate(template: Template): void
deleteTemplate(templateId: string): void
```

---

## ğŸ†˜ FelsÃ¶kning

### **Problem: "Bookmark-knappen syns inte"**
**Orsak:** Inga objekt Ã¤r markerade.

**LÃ¶sning:**
1. Markera minst 1 objekt pÃ¥ canvas
2. Bookmark-knappen (ğŸ’¾) dyker upp
3. Den Ã¤r blÃ¥ och har en border fÃ¶r att synas tydligt

### **Problem: "Mall placeras pÃ¥ fel stÃ¤lle"**
**Orsak:** Mallens koordinater Ã¤r relativa till Ã¶vre vÃ¤nstra hÃ¶rnet.

**LÃ¶sning:**
- NÃ¤r du klickar pÃ¥ canvas placeras mallens "origo" (0,0) vid klickpunkten
- Objekten sprids ut frÃ¥n denna punkt enligt relativa positioner

### **Problem: "Objekt i mall hÃ¤nger inte ihop efter placering"**
**Detta Ã¤r avsiktligt!**

**FÃ¶rklaring:**
- Mallar skapar **individuella shapes**, inte grupper
- Detta lÃ¥ter dig editera varje objekt separat
- Om du vill flytta allt: Markera alla (Cmd+A eller dra markÃ¶r) â†’ Dra

### **Problem: "Kan inte hitta min sparade mall"**
**LÃ¶sning:**
1. Ã–ppna Template Gallery
2. Kontrollera kategori-filter (sÃ¤tt till "Alla kategorier")
3. SÃ¶k pÃ¥ mallens namn
4. Kolla Console (F12) fÃ¶r fel

### **Problem: "Mallar fÃ¶rsvann efter browser-refresh"**
**Orsak:** localStorage rensades eller annan browser.

**LÃ¶sning:**
1. Mallar sparas per browser/device
2. AnvÃ¤nd "Exportera" regelbundet fÃ¶r backup
3. Importera frÃ¥n backup om mallar fÃ¶rsvinner

---

## ğŸ“ BÃ¤sta Praxis

### **1. Namnge Tydligt**
```
âœ… BRA:
- "L-vÃ¤gg 3m+2m"
- "Badrum Standard 2Ã—2m"
- "Eluttag Trio 150cm mellanrum"

âŒ DÃ…LIGT:
- "Mall 1"
- "Test"
- "Badrum"
```

### **2. AnvÃ¤nd Kategorier**
```
Organisera per typ:
- VÃ¤ggar â†’ Alla vÃ¤ggstrukturer
- Badrum â†’ Kompletta badrum eller fixtures
- KÃ¶k â†’ KÃ¶ks-layouts
- El â†’ El-konfigurationer
```

### **3. LÃ¤gg Till Beskrivningar**
```
Beskriv:
- Vad mallen innehÃ¥ller
- Dimensioner
- AnvÃ¤ndningsomrÃ¥de

Exempel:
"Komplett kÃ¶k i U-form med spis, kyl, diskho och 3m bÃ¤nkyta. 
Passar 3Ã—3m kÃ¶k."
```

### **4. AnvÃ¤nd Taggar**
```
LÃ¤gg till sÃ¶kbara taggar:
- "standard", "modern", "kompakt"
- "50cm", "1m", "2m"
- "svart", "vit", "rostfri"
```

### **5. Exportera Regelbundet**
```
En gÃ¥ng i mÃ¥naden:
1. Exportera alla mallar
2. Spara JSON-fil med datum i namnet
3. Lagra i molnet (Dropbox, Google Drive)
â†’ SÃ¤kerhetskopia om nÃ¥got hÃ¤nder!
```

### **6. Dela med Teamet**
```
Skapa en standard-mall-fil fÃ¶r fÃ¶retaget:
1. Rita alla standard-mallar
2. Exportera: "company-templates-2026.json"
3. Dela med kollegor
4. Alla importerar samma fil
â†’ Konsistent design Ã¶ver hela teamet!
```

---

## ğŸ“ˆ Avancerade Tekniker

### **Teknik 1: NÃ¤stlade Mallar**

Du kan **inte** spara en mall inuti en annan mall direkt, men:

```
1. Placera mall A
2. Placera mall B bredvid
3. Markera alla objekt frÃ¥n bÃ¥da
4. Spara som ny mall C
â†’ Mall C innehÃ¥ller alla objekt frÃ¥n A + B!
```

### **Teknik 2: Variationer pÃ¥ Mallar**

**Scenario:** Du vill ha 3 varianter av samma badrum.

```
1. Spara "Badrum Bas" (grundlayout)
2. Placera "Badrum Bas" pÃ¥ canvas
3. LÃ¤gg till dusch-kabinett
4. Spara som "Badrum Med Dusch"
5. Placera "Badrum Bas" igen
6. LÃ¤gg till badkar istÃ¤llet
7. Spara som "Badrum Med Badkar"
â†’ 3 mallar frÃ¥n samma bas!
```

### **Teknik 3: Scaling Efter Placering**

**Scenario:** Mall Ã¤r fÃ¶r stor/liten.

```
1. Placera mall
2. Markera alla objekt (Cmd+A)
3. AnvÃ¤nd transform-handles fÃ¶r att scala
4. Om du gillar nya storleken:
   - Spara som ny mall med nytt namn
   - T.ex. "Badrum Standard â†’ Badrum Kompakt"
```

---

## ğŸ‰ Sammanfattning

### **Vad Du Nu Kan:**

âœ… **Spara grupper av objekt** som Ã¥teranvÃ¤ndbara mallar  
âœ… **Placera mallar** med ett klick pÃ¥ canvas  
âœ… **Editera varje objekt** individuellt efter placering  
âœ… **Organisera mallar** i kategorier  
âœ… **Exportera/Importera** fÃ¶r backup och delning  
âœ… **SÃ¶ka och filtrera** mallar i galleriet  
âœ… **Dela med teamet** via JSON-export  

### **ArbetsflÃ¶de:**

```
1. Rita/Placera objekt pÃ¥ canvas
2. Arrangera dem
3. Markera alla
4. Klicka ğŸ’¾ (Bookmark) â†’ "Spara som Mall"
5. Ge namn, kategori, beskrivning
6. Spara

Senare:
1. Klicka ğŸ“‹ (Copy) â†’ Template Gallery
2. VÃ¤lj mall
3. Klicka pÃ¥ canvas
4. âœ… Alla objekt placeras som vanliga editerbara shapes!
```

---

**Implementerat: 2026-01-21**  
**Status: Produktionsklar**  
**Inga Linter-fel**

ğŸ¨ **Bygg ditt eget snippet-library fÃ¶r arkitektur!** ğŸ“‹âœ¨

---

## ğŸ“ Change Log

### **Version 1.0 (2026-01-21)**
- âœ… Template saving frÃ¥n markerade objekt
- âœ… Template Gallery UI
- âœ… Template placement pÃ¥ canvas
- âœ… Kategori-system
- âœ… SÃ¶k & filter
- âœ… Export/Import JSON
- âœ… localStorage persistence
- âœ… Alla objekt blir individuellt editerbara efter placering
